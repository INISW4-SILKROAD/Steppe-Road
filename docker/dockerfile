# 베이스 이미지로 CUDA 11.1 및 cuDNN 8이 포함된 Ubuntu 20.04 사용
FROM nvidia/cuda:11.1.1-cudnn8-devel-ubuntu20.04

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive

# Install necessary dependencies
RUN apt-get update && apt-get install -y \
    python3.8 \
    python3-pip \
    python3.8-dev \
    git \
    curl \
    wget \
    libgl1-mesa-glx \
    libxrender1 \
    libxtst6 \
    libxext6 \
    libsm6 \
    build-essential \
    libproj-dev \
    proj-data \
    proj-bin \
    libgeos-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Update alternatives to use python3.8
RUN update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 1

# Upgrade pip
RUN pip3 install --upgrade pip

# Install other dependencies
RUN pip3 install mayavi cartopy

# Install ImageBind
RUN pip3 install git+https://github.com/facebookresearch/ImageBind.git

# Install CLIP
RUN pip3 install git+https://github.com/openai/CLIP.git

# Install PyTorch, Torchvision, and Torchaudio
RUN pip3 install torch==1.10.1+cu111 torchvision==0.11.2+cu111 torchaudio==0.10.1+cu111 --extra-index-url https://download.pytorch.org/whl/cu111

# Verify installations
RUN python3 -c "import torch; print(torch.__version__)"
RUN python3 -c "import torchvision; print(torchvision.__version__)"
RUN python3 -c "import torchaudio; print(torchaudio.__version__)"
RUN python3 -c "import imagebind; print('ImageBind installed')"
RUN python3 -c "import clip; print('CLIP installed')"
RUN python3 -c "import mayavi; print('Mayavi installed')"
RUN python3 -c "import cartopy; print('Cartopy installed')"
